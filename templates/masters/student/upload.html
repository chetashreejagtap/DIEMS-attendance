{% extends "dashboard/base.html" %}

{% block content %}
<div class="nk-block nk-block-lg">
    <div class="card card-bordered">
        <div class="card-inner">
            <form method="POST" class="form-validate is-alter" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="row g-gs">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="form-label" for="fva-semester">Semester</label>
                            <div class="form-control-wrap ">
                                <select class="form-control form-select" id="fva-semester" name="fva-semester"
                                        data-placeholder="Select a Semester" required>
                                    <option label="empty" value=""></option>
                                    {% for s in semesters %}
                                    <option value="{{ s.id }}"> Sem {{ s.sem_num }} {{ s.get_sem_year_display }} {{ s.department.short }}
                                    </option>
                                    {% endfor %}
                                </select>

                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="form-label" for="fva-class">Class</label>
                            <div class="form-control-wrap ">
                                <select class="form-control form-select" id="fva-class" name="fva-class"
                                        data-placeholder="Select Class" required>
                                    <option label="empty" value=""></option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="form-label" for="excel_file">Excel Upload</label>
                            <div class="form-control-wrap">
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input" name="excel_file" id="excel_file">
                                    <label class="custom-file-label" for="excel_file">Choose file</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label" for="download_sample">Download Sample</label>
                        <div class="form-group">
                            <a href="{% url 'download_sample_file' %}" id='download_sample' class="btn btn-lg btn-light" download><em class="icon ni ni-download"></em></a>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <button type="submit" class="btn btn-lg btn-primary">Upload File</button>
                        </div>
                    </div>

                    {% if error %}
                    <div class="col-md-12">
                        <div class="alert alert-danger alert-icon">
                            <em class="icon ni ni-cross-circle"></em> <strong> {{ error }} </strong>
                        </div>
                    </div>
                    {% endif %}

                </div>

            </form>


        </div>
    </div>
</div><!-- .nk-block -->
{% endblock %}


{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // When the semester select box changes
    $('#fva-semester').on('change', function() {
        // Get the selected semester ID
        var semId = $(this).val();

        // Check if a semester is selected
        if (semId) {
            // Perform an AJAX request to get the classes
            $.ajax({
                url: '{% url "get_classes" %}', // Replace with your actual URL name
                data: {'sem_id': semId},
                dataType: 'json',
                success: function(data) {
                    var classSelect = $('#fva-class');
                    classSelect.empty();
                    classSelect.append('<option value="">Select Class</option>');

                    // Populate the class select box with the retrieved classes
                    $.each(data.classes, function(index, cls) {
                        classSelect.append('<option value="' + cls.id + '">' + cls.name + '</option>');
                    });
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.error('Error: ' + errorThrown);
                    // Handle the error here if needed
                }
            });
        } else {
            // If no semester is selected, clear the class select box
            $('#fva-class').empty();
        }
    });
});
</script>


{% endblock %}
