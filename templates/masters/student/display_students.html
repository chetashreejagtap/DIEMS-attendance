{% extends "dashboard/base.html" %} {% block content %}
<div class="nk-block nk-block-lg">
  {% if message %}
  <div class="alert alert-fill alert-success alert-icon">
    <em class="icon ni ni-check-circle"></em> <strong>Done</strong>, {{ message
    }}
  </div>
  {% endif %} {% if error %}
  <div class="alert alert-fill alert-danger alert-icon">
    <em class="icon ni ni-cross-circle"></em> <strong>Error</strong>, {{ error}}
  </div>
  {% endif %}
  <div class="card card-bordered">
    <div class="card-inner">
      <form action="#" method="post" class="form-validate is-alter">
        {% csrf_token %}
        <div class="row g-gs">
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label" for="fva-semester">Semester</label>
              <div class="form-control-wrap">
                <select
                  class="form-control form-select"
                  id="fva-semester"
                  name="fva-semester"
                  data-placeholder="Select a Semester"
                  required
                >
                  <option label="empty" value=""></option>
                  {% for s in semesters %}
                  <option value="{{ s.id }}">
                    Sem {{ s.sem_num }} {{ s.get_sem_year_display}}
                    {{s.department.short }}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label" for="fva-class">Class</label>
              <div class="form-control-wrap">
                <select
                  class="form-control form-select"
                  id="fva-class"
                  name="fva-class"
                  data-placeholder="Select a Class"
                  required
                >
                  <option label="empty" value=""></option>
                </select>
              </div>
            </div>
          </div>

          <div class="col-md-12">
            <div class="form-group">
              <button type="submit" class="btn btn-lg btn-primary">
                Search
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- .nk-block -->

<div class="nk-block nk-block-lg">
  <div class="nk-block-head">
    <div class="nk-block-head-content">
      <h4 class="nk-block-title">Student Details</h4>
    </div>
  </div>
  <div class="card card-preview">
    <div class="card-inner">
      <table
        class="datatable-init nk-tb-list nk-tb-ulist"
        data-auto-responsive="false"
      >
        <thead>
          <tr class="nk-tb-item nk-tb-head">
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">Batu PRN</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">College PRN</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">Roll No</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">Email</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">Student Contact</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">Parents Contact</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">First Name</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">Middle Name</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">Last Name</span>
            </th>
            <th class="nk-tb-col tb-col-mb">
              <span class="sub-text">Address</span>
            </th>

            <th class="nk-tb-col nk-tb-col-tools">
              <span class="sub-text"></span>
            </th>
          </tr>
        </thead>
        <tbody>
          {% for student in student_details_info %}
          <tr class="nk-tb-item">
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.batu_prn}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.prn}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.roll_no}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.email}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.self_phone_number}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.parents_phone_number}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.first_name}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.middle_name}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.last_name}} </span>
            </td>
            <td class="nk-tb-col tb-col-mb" data-order="35040.34">
              <span class="tb-amount">{{student.address}} </span>
            </td>
            <td class="nk-tb-col nk-tb-col-tools">
              <ul class="nk-tb-actions gx-1">
                <li class="nk-tb-action">
                </li>
                <li class="nk-tb-action">
                  <button
                    type="button"
                    class="btn btn-trigger btn-icon"
                    data-toggle="modal"
                    data-target="#confirmDeleteModal{{ batch_item.id }}"
                    data-placement="top"
                    title="Delete"
                  >
                    <em class="icon ni ni-trash"></em>
                  </button>
                   <a
                      href="{% url 'edit_student' prn=student.prn %}"
                      class="btn btn-trigger btn-icon"
                      data-toggle="tooltip"
                      data-placement="top"
                      title="Edit"
                    >
                      <i class="material-icons">edit</i>
                </li>
              </ul>
            </td>
            <div
              class="modal fade"
              id="confirmDeleteModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="confirmDeleteModalLabel"
              aria-hidden="true"
            >
              <!-- Modal content here... -->
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">
                      Confirm Deletion
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <p>
                      Are you sure you want to delete the class "{{
                      student.batu_prn }} {{ student.prn }} {{ student.roll_no
                      }}
                      {{student.email}}{{student.self_phone_number}}{{student.parents_phone_number}}
                      {{student.first_name}}{{student.middle_name}}{{student.last_name}}{{student.address}}"?
                    </p>
                  </div>
                  <div class="modal-footer">
                    <!-- Button to cancel deletion -->
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-dismiss="modal"
                    >
                      Cancel
                    </button>
                    <!-- Button to confirm deletion, link it to your delete URL -->
                    <a href="{% url 'delete_student' student.prn %}" class="btn btn-danger">Delete</a>
                   
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </tr>
          {% endfor %}
          <!-- .nk-tb-item  -->
        </tbody>
      </table>
    </div>
  </div>
  <!-- .card-preview -->
</div>
<!-- nk-block -->
{% endblock %} {% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    // When the semester select box changes
    $("#fva-semester").on("change", function () {
      // Get the selected semester ID
      var semId = $(this).val();

      // Check if a semester is selected
      if (semId) {
        // Perform an AJAX request to get the classes
        $.ajax({
          url: '{% url "get_classes" %}', // Replace with your actual URL name
          data: { sem_id: semId },
          dataType: "json",
          success: function (data) {
            var classSelect = $("#fva-class");
            classSelect.empty();
            classSelect.append('<option value="">Select Class</option>');

            // Populate the class select box with the retrieved classes
            $.each(data.classes, function (index, cls) {
              classSelect.append(
                '<option value="' + cls.id + '">' + cls.name + "</option>"
              );
            });
          },
          error: function (xhr, textStatus, errorThrown) {
            console.error("Error: " + errorThrown);
            // Handle the error here if needed
          },
        });
      } else {
        // If no semester is selected, clear the class select box
        $("#fva-class").empty();
      }
    });
  });
</script>

{% endblock %}
